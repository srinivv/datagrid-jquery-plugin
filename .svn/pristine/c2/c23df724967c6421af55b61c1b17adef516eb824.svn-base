<style>
.ui-autocomplete-loading {
	background: white url('http://jqueryui.com/resources/demos/autocomplete/images/ui-anim_basic_16x16.gif') right center
		no-repeat;
}
</style>
<script type="text/template" id="customer-template">
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="countryListing" id="pertnerList">
	<tbody>
		<tr>
			<th width="320">Company Name</th>
			<th width="200">Address 1</th>
			<th width="100">Address 2</th>
			<th width="150">City</th>
			<th width="100">Province</th>
			<th width="100">Zip Code</th>
			<th width="100">Country</th>
		</tr>
		<tr>
			<td><strong class="nodeName"><@= data.accountName @></strong></td>
			<td><@= data.addr1 @></td>
			<td><@= data.addr2 @></td>
			<td><@= data.city @></td>
			<td><@= data.province @></td>
			<td><@= data.zip @></td>
			<td><@= data.country @></td>
		</tr>
	</tbody>
</table>
</script>

<script>
	$(function() {
		function log(json) {
     		$("#log").html( _.template($('#customer-template').html(), { data: json } ));
		}
		$("#city").autocomplete({
			source : function(request, response) {
				$.ajax({
					url : "http://webapa-dev01.cisco.com:8080/ICW/SDS/indexViewer?requestType=DEMO",
					dataType : "jsonp",
					data : {
						featureClass : "P",
						style : "full",
						maxRows : 12,
						currentPage : 1,
						requestType : "DEMO",
						searchQuery : request.term
					},
					success : function(data) {
						response($.map(data.data.rows, function(item) {
							return {
								label : highlight(item.party_name + 
										(item.address1 ? ", " + item.address1 : "") + 
										(item.address2 ? ", " + item.address2 : "") +
										(item.address3 ? ", " + item.address3 : "") +
										(item.address4 ? ", " + item.address4 : "") +
										(item.city ? ", " + item.city : "") +
										(item.province ? ", " + item.province : "") +
										(item.zipcode ? ", " + item.zipcode : "") +
										(item.country ? ", " + item.country: ""), request.term),
								value : item.party_name,
								object : {
									accountName : item.party_name, 
									addr1 : (item.address1 ? item.address1 : ""),
									addr2 : (item.address2 ? item.address2 : ""),
									city : (item.city? item.city : ""),
									province : (item.province ? item.province : ""),
									zip : (item.zipcode ? item.zipcode : ""),
									country : (item.country ? item.country: "")
								} 
							}
						}));
					}
				});
			},
			minLength : 2,
			select : function(event, ui) {
				log(ui.item ? ui.item.object : "Nothing selected, input was " + this.value);
			},
	        search: function(event, ui) { 
	        	$('.loader').hide();
	        },
			open : function() {
	        	$('.loader').hide();
				$(this).removeClass("ui-corner-all").addClass("ui-corner-top");
			},
			close : function() {
				$(this).removeClass("ui-corner-top").addClass("ui-corner-all");
			}
		}).data( "autocomplete" )._renderItem = function( ul, item ) {
           // only change here was to replace .text() with .html()
           return $( "<li></li>" )
              .data( "item.autocomplete", item )
              .append( $( "<a></a>" ).html(item.label) )
              .appendTo( ul );
    		};
	});
	
	function highlight(s, t) {
	  var matcher = new RegExp("("+$.ui.autocomplete.escapeRegex(t)+")", "ig" );
	  return s.replace(matcher, "<b style='color:#1E76C7'>$1</b>");
	}
</script>


<div class="subHeading">
	<h1 class="nodesHeading">Customer Search</h1>
</div>
<div id="SearchAddNode" style="width:860px">
	<div class="select-prod" style="font-size: 24px; color:white">
		Search:
	</div>
	<div class="bigSearch">
		<input type="text" autocomplete="off" id="city"
			class="ac_input" style="background-color: #fff"
			onblur="if(this.value==''){this.value='Enter Customer Name or Address'};"
			onfocus="if(this.value=='Enter Customer Name or Address'){this.value=''};"
			value="Enter Customer Name or Address">

	</div>
	<input type="text" class="searchSubmit searchPro" id="searchCustomerbutton">

	<div class="clear"></div>
</div>
<div class="tableList">
	<div id="log"></div>
</div>
