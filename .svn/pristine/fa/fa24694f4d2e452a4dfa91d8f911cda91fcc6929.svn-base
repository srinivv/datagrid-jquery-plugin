<%@ taglib prefix="s" uri="/struts-tags" %>
<%@ include file="common/exception-templates.jsp" %>
<%@page import="com.cisco.apas.entity.Node"%>

<script type="text/javascript" src="<%=request.getContextPath()%>/js/exception.js"></script>

 <div class="partnerMainArea">
	<div class="subHeading">
	    <h1>Add Partner Exception</h1>
	</div>
	<div id="partnerErrorMsg">
		<div class="messageError partnerError" style="display:none;">Please enter Partner ID/Name.</div>
		<div class="messageError dateError" style="display:none;">Please select the start/end date.</div>
		<div class="messageError noNodesError" style="display:none;">Please add some nodes to create exception.</div>
		<div class="messageError unknowError" style="display:none;">An error occurred. Please see the log for more details</div>
	</div>  
	
	<div class="partnerSearchOutter" style="display: none;">
		<h3 class="head1">Search Node using SKU</h3>
		<form name="searchForm" action="node_searchresult.do" method="POST">
			<div id="SearchAddNode">
				<div class="select-prod">
					<select class="moreCategoriesSelect" id="selectExceptionSKU">
						<option value="serviceSKU">Service SKU</option>
						<option value="productSKU">Product SKU </option>
					</select>
				</div>
				<div class="bigSearch">
					<input type="text" autocomplete="off" id="searchException"
						class="ac_input" style="background-color: #fff"
						onblur="if(this.value==''){this.value='Enter SKU'};"
						onfocus="if(this.value=='Enter SKU'){this.value=''};"
						value="Enter SKU">

				</div>
				<input type="text" class="searchSubmit searchPro"
					id="searchExceptionbutton">

				<div class="clear"></div>
			</div>
		</form>
		
		<div id="searchExceptionresult"></div>
		<div class="buttonsArea partnerbuttons" id="buttonsArea">
					<a id="addNodes" href="javascript:getNodeList(document.searchExceptionForm)"
						class="doneButton addnodetoExp" style="display:none">Add Node to Exception</a> <a
						href="javascript://" id="cancelButton" class="doneButton cancelnodeExp">Cancel</a>
		</div>	
		<div class="clear"> </div>
			
	</div>
	<div class="partnerformarea">
	
			<div id="ManualAddNode">
				<div class="box dealBox">
					<p>
						<label>Partner:<span class="error">*</span></label> <input
							type="text" class="input" id="partnerName" name="partnerName">
							<input type="hidden" id="partnerId" name="partnerId">
						<br clear="left" /> <small>(Enter Partner ID/Name)</small>
					</p>
					<p>
						<span class="boxWidthSmall alignleft"> <label>Start
								Date:<span class="error">*</span>
						</label> <input id="startDate" name="startDate" type="text"
							class="input datepicker">

						</span> <span class="boxWidthSmall alignright"> <label>End
								Date:<span class="error"></span>
						</label> <input type="text" id="endDate" name="endDate"
							class="input datepicker">
						</span>

					</p>
					<div class="clear"></div>
				</div>
				<div class="box dealBox1">

					<p>
						<label>Exception Description:</label>
						<textarea id="description" name="description" type="text"
							class="textarea"></textarea>
					</p>
					<div class="clear"></div>
					<div class="formButtonArea">
						<input type="button" value="Add Exception"
							id="savePartnerException" class="formButton addException" /> <a
							href="home.do" class="cancelExp disableBTN">Cancel</a>
					</div>
				</div>
				<div class="clear"></div>
			</div>
			
			<div class="setDealNameArea" id="addmorenodes">
				<a href="javascript://" class="addMoreExp tooltip"
					title="Add more Nodes">+</a>
				<h3 class="head1">Partner Exception will be added to the
					following selected Nodes:</h3>
				<ul id="nodeList">
				<s:iterator value="nodeList" var="node" status="status">
					<li id="node<s:property value='#status.count'/>">
						<a href="#"><s:property value="#node.name" /><span onclick="javascript:removeSelectedNode('node<s:property value='#status.count'/>')"></span></a>	
						<input type="hidden" id="nodeId" name="nodeId" value='<s:property value="#node.id" />' />
					</li>
				</s:iterator>
				</ul>
			</div>
			<div class="clear"></div>

	</div>
	<div class="partnersuccesArea">
		<p>You have successfully added Partner Exception to the selected nodes</p>
		<a href="partnerException.do">View Partner Exception</a>
		<a href="javascript://" class="morepartner">Add more Partner Exception</a>
	</div>
</div> 

<link rel="stylesheet" type="text/css" href="<%=request.getContextPath()%>/css/jquery-ui-apas.css" />
<script>
	toggleLeftNavigationMenus('partnerexception');
	
	$(document).ready(function() {
		// Partner search by id / name
	    $( "#partnerName" ).autocomplete({
	        minLength: 3,
	        search: function(event, ui) { 
	        	$('.loader').hide();
	            $(this).addClass('spinner');
	        },
	        open: function(event, ui) {
	        	$('.loader').hide();
	            $(this).removeClass('spinner');
	        },
	        source:   function (request, response) {
	            $.getJSON("partnerException_searchPartnerName.do", { term: $( "#partnerName" ).val() }, response);
	        },
	        select: function( event, ui ) {
	        	var selectedValue = ui.item.value;
	        	$( "#partnerName" ).val(selectedValue);
	        	
	        	if (selectedValue.lastIndexOf("(")) {
	        		selectedValue = selectedValue.substring(selectedValue.lastIndexOf("(")+1, selectedValue.lastIndexOf(")"));
	        	} else {
	        		selectedValue = '';
	        	}
	        	
	        	$( "#partnerId" ).val(selectedValue);
	            return false;
	        }
	    });
	});
	
</script>