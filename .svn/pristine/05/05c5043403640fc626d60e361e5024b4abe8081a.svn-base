<%@ taglib prefix="s" uri="/struts-tags" %>
<%@ include file="common/exception-templates.jsp" %>
<%@page import="com.cisco.apas.entity.Node"%>

	<div class="partnerMainArea">
		<div class="subHeading">
			<h1>Add Deal Exception</h1>
		</div>
		<div id="dealErrorMsg">
			<div class="messageError dealError" style="display:none;">Please enter deal ID/Name.</div>
			<div class="messageError dateError" style="display:none;">Please select the start/end date.</div>
			<div class="messageError noNodesError" style="display:none;">Please add some nodes to create exception.</div>
			<div class="messageError unknowError" style="display:none;">An error occurred. Please see the log for more details</div>
		</div>  
		
		<div class="partnerSearchOutter" style="display: none;">
			<h3 class="head1">Search Node using SKU</h3>
			 <form name="searchDExceptionForm" action="node_searchresult.do" method="POST" >
			<div id="SearchAddNode">
				<div class="select-prod">
					<select class="moreCategoriesSelect" id="selectDExceptionSKU" style="display: none;">
						<option value="serviceSKU">Service SKU</option>
						<option value="productSKU">Product SKU </option>
					</select>
				</div>
				<div class="bigSearch">
                      <input type="text" autocomplete="off" id="searchDException" class="ac_input" style="background-color:#fff"  onblur="if(this.value==''){this.value='Enter SKU'};" onfocus="if(this.value=='Enter SKU'){this.value=''};"  value="Enter SKU">
                 </div>
                      <input type="text" class="searchSubmit searchPro" id="searchDExceptionbutton">
                 <div class="clear"></div>
			</div>
			</form>
			<div id="searchDExceptionresult"></div>
			<div class="buttonsArea partnerbuttons" id="buttonsArea">
					<a id="addNodes" href="javascript:getNodeList(document.searchExceptionForm)"
						class="doneButton addnodetoExp" style="display:none">Add Node to Exception</a> <a
						href="javascript://" id="cancelButton" class="doneButton cancelnodeExp">Cancel</a>
			</div>	
			<div class="clear"> </div>
		</div>
			
		
		</div>
		<div class="partnerformarea">
		
			<div id="ManualAddNode">
				<div class="box dealBox">
					<p>
						<label> Deal: <span class="error">*</span>
						</label> <input class="input" type="text" id="dealName" name="dealName"> <br clear="left">
						<input type="hidden" id="dealId" name="dealId">
						<small>(Enter Deal ID/Name)</small>
					</p>
					<p>
						<span class="boxWidthSmall alignleft"> <label>
								Start Date: <span class="error">*</span>
						</label> <input id="startDate" name="startDate"
							class="apasDatePick" type="text">
						</span> <span class="boxWidthSmall alignright"> <label>
								End Date: <span class="error"></span>
						</label> <input id="endDate" name="endDate"
							class="apasDatePick" type="text">
						</span>
					</p>
					<div class="clear"></div>
				</div>
				<div class="box dealBox1">
					<p>
						<label>Exception Description:</label>
						<textarea id ="description" name="description" class="textarea" type="text"></textarea>
					</p>
					<div class="clear"></div>
					<div class="formButtonArea">
						<input class="formButton addException" type="button" id="saveDealException"
							value="Add Exception"> <a class="cancelExp disableBTN"
							href="home.do">Cancel</a>
					</div>
				</div>
				<div class="clear"></div>
			</div>
			<div class="setDealNameArea">
				<a class="addMoreExp tooltip" href="javascript://"
					original-title="Add more Nodes">+</a>
				<h3 class="head1">Deal Exception will be added to the following
					selected Nodes:</h3>
				<ul id="nodeDList">
				<s:iterator value="nodeList" var="node" status="status">
					<li id="node<s:property value='#status.count'/>">
						<a href="#"><s:property value="#node.name" /><span onclick="javascript:removeSelectedNode('node<s:property value='#status.count'/>')"></span></a>	
						<input type="hidden" id="nodeDId" name="nodeDId" value='<s:property value="#node.id" />' />
					</li>
				</s:iterator>
				</ul>
			</div>
			<div class="clear"></div>
		
		</div>
		<div class="partnersuccesArea">
			<p>You have successfully added Deal Exception to the selected
				nodes</p>
			<a href="dealException.do">View Deal Exception</a> <a
				class="morepartner" href="javascript://">Add more Deal Exception</a>
		</div>
	</div>


<script type="text/javascript" src="<%=request.getContextPath()%>/js/exception.js"></script>
<link rel="stylesheet" type="text/css" href="<%=request.getContextPath()%>/css/jquery-ui-apas.css" />
<script>
	toggleLeftNavigationMenus('dealexception');
	$(document).ready(function() {
		// Deal search by id / name
	    $( "#dealName" ).autocomplete({
	        minLength: 4,
	        search: function(event, ui) { 
	        	$('.loader').hide();
	            $(this).addClass('spinner');
	        },
	        open: function(event, ui) {
	        	$('.loader').hide();
	            $(this).removeClass('spinner');
	        },
	        source:   function (request, response) {
	            $.getJSON("dealException_searchDealName.do", { term: $( "#dealName" ).val() }, response);
	        },
	        select: function( event, ui ) {
	        	var selectedValue = ui.item.value;
	        	$( "#dealName" ).val(selectedValue);
	        	
	        	
	        	if (selectedValue.lastIndexOf("(")) {
	        		selectedValue = selectedValue.substring(selectedValue.lastIndexOf("(")+1, selectedValue.lastIndexOf(")"));
	        	} else {
	        		selectedValue = '';
	        	}
	        	
				$( "#dealId" ).val(selectedValue);
	            return false;
	        }
	    });
	});
	
</script>